From fbc1716a0e1126cef278885cb7452d542b7e2faa Mon Sep 17 00:00:00 2001
From: Paul Spooren <mail@aparcar.org>
Date: Thu, 2 Dec 2021 16:09:40 -1000
Subject: [PATCH] Preserve environment

Signed-off-by: Paul Spooren <mail@aparcar.org>
---
 src/database.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/src/database.c b/src/database.c
index 3776bb1..05cd883 100644
--- a/src/database.c
+++ b/src/database.c
@@ -1874,10 +1874,6 @@ int apk_db_run_script(struct apk_database *db, char *fn, char **argv)
 	struct apk_out *out = &db->ctx->out;
 	int status;
 	pid_t pid;
-	static char * const environment[] = {
-		"PATH=/usr/sbin:/usr/bin:/sbin:/bin",
-		NULL
-	};
 
 	pid = fork();
 	if (pid == -1) {
@@ -1897,7 +1893,8 @@ int apk_db_run_script(struct apk_database *db, char *fn, char **argv)
 			exit(127);
 		}
 
-		execve(fn, argv, environment);
+		extern char** environ;
+		execve(fn, argv, environ);
 		exit(127); /* should not get here */
 	}
 	while (waitpid(pid, &status, 0) < 0 && errno == EINTR);
-- 
2.30.2

