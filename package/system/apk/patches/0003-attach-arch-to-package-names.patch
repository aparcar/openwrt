From b42ccd4ee32ba514d11a74f0bd69fb98d7f10f0f Mon Sep 17 00:00:00 2001
From: Paul Spooren <mail@aparcar.org>
Date: Mon, 28 Mar 2022 23:52:25 +0100
Subject: [PATCH 3/5] attach arch to package names

Signed-off-by: Paul Spooren <mail@aparcar.org>
---
 src/apk_package.h | 4 ++--
 src/database.c    | 2 ++
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/apk_package.h b/src/apk_package.h
index eb97095..8cd33d8 100644
--- a/src/apk_package.h
+++ b/src/apk_package.h
@@ -102,8 +102,8 @@ APK_ARRAY(apk_package_array, struct apk_package *);
 #define APK_PROVIDER_FROM_PACKAGE(pkg)	  (struct apk_provider){(pkg),(pkg)->version}
 #define APK_PROVIDER_FROM_PROVIDES(pkg,p) (struct apk_provider){(pkg),(p)->version}
 
-#define PKG_VER_FMT		"%s_" BLOB_FMT
-#define PKG_VER_PRINTF(pkg)	pkg->name->name, BLOB_PRINTF(*pkg->version)
+#define PKG_VER_FMT		"%s_" BLOB_FMT "_" BLOB_FMT
+#define PKG_VER_PRINTF(pkg)	pkg->name->name, BLOB_PRINTF(*pkg->version), BLOB_PRINTF(*pkg->arch)
 #define PKG_FILE_FMT		PKG_VER_FMT ".apk"
 #define PKG_FILE_PRINTF(pkg)	PKG_VER_PRINTF(pkg)
 
diff --git a/src/database.c b/src/database.c
index 32928c8..788a230 100644
--- a/src/database.c
+++ b/src/database.c
@@ -565,6 +565,8 @@ static int apk_pkg_format_cache_pkg(apk_blob_t to, struct apk_package *pkg)
 	apk_blob_push_blob(&to, APK_BLOB_STR(pkg->name->name));
 	apk_blob_push_blob(&to, APK_BLOB_STR("_"));
 	apk_blob_push_blob(&to, *pkg->version);
+	apk_blob_push_blob(&to, APK_BLOB_STR("_"));
+	apk_blob_push_blob(&to, *pkg->arch);
 	apk_blob_push_blob(&to, APK_BLOB_STR("."));
 	apk_blob_push_hexdump(&to, APK_BLOB_PTR_LEN((char *) pkg->csum.data,
 						    APK_CACHE_CSUM_BYTES));
-- 
2.35.1

