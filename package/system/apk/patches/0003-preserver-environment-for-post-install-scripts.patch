From a781a7688d66b5d5d40fca673865674ce229dcd2 Mon Sep 17 00:00:00 2001
From: Paul Spooren <mail@aparcar.org>
Date: Wed, 8 Dec 2021 12:05:21 -1000
Subject: [PATCH 3/5] preserver environment for post-install scripts

don't overwrite e.g. IPKG_INSTROOT
---
 src/database.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/src/database.c b/src/database.c
index 79e37f9..d314435 100644
--- a/src/database.c
+++ b/src/database.c
@@ -1874,10 +1874,6 @@ int apk_db_run_script(struct apk_database *db, char *fn, char **argv)
 	struct apk_out *out = &db->ctx->out;
 	int status;
 	pid_t pid;
-	static char * const environment[] = {
-		"PATH=/usr/sbin:/usr/bin:/sbin:/bin",
-		NULL
-	};
 
 	pid = fork();
 	if (pid == -1) {
@@ -1897,7 +1893,8 @@ int apk_db_run_script(struct apk_database *db, char *fn, char **argv)
 			exit(127);
 		}
 
-		execve(fn, argv, environment);
+		extern char **environ;
+		execve(fn, argv, environ);
 		exit(127); /* should not get here */
 	}
 	while (waitpid(pid, &status, 0) < 0 && errno == EINTR);
-- 
2.30.2

