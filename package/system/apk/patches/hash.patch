diff --git a/doc/apk-package.5.scd b/doc/apk-package.5.scd
index 932970a77c89cb8edb8bddd627319d025eea6973..bb669adf7c765b0600f6b61ad6cbc5cc9b488db2 100644
--- a/doc/apk-package.5.scd
+++ b/doc/apk-package.5.scd
@@ -49,7 +49,7 @@ Unfortunately it is not possible to deduce if a given string is of format
 	followed the Gentoo package version specification.
 
 	Currently the APK version specification is as follows:
-	*number{.number}...{letter}{\_suffix{number}}...{-r#}*
+	*number{.number}...{letter}{\_suffix{number}}...{~hash}{-r#}*
 
 	Each *number* component is a sequence of digits (0-9).
 
@@ -59,6 +59,10 @@ Unfortunately it is not possible to deduce if a given string is of format
 	of valid suffixes (and their sorting order) is:
 	*alpha*, *beta*, *pre*, *rc*, <no suffix>, *cvs*, *svn*, *git*, *hg*, *p*
 
+	This can be follows with an optional *{~hash}* to indicate a commit
+	hash from where it was built. This can be any length string of
+	lower case hexdecimal digits (0-9a-f).
+
 	Finally an optional package build component *-r{number}* can follow.
 
 *unique-id* (*C*)
diff --git a/src/version.c b/src/version.c
index 118a59cee53b8a2e76646a0613ce7886d1914503..d1e758c295a894d4f5d6d1ac5fef587c74050b11 100644
--- a/src/version.c
+++ b/src/version.c
@@ -14,7 +14,7 @@
 
 #define DEBUG 0
 
-/* Alpine version: digit{.digit}...{letter}{_suf{#}}...{-r#} */
+/* Alpine version: digit{.digit}...{letter}{_suf{#}}...{~hash}{-r#} */
 
 static const apk_spn_match_def spn_suffix = {
 	[12] = 0xfe, /* a-g */
@@ -23,12 +23,19 @@ static const apk_spn_match_def spn_suffix = {
 	[15] = 0x07, /* x-z */
 };
 
+static const apk_spn_match_def spn_commit_hash = {
+	[6]  = 0xff, /* 0-7 */
+	[7]  = 0x03, /* 8-9 */
+	[12] = 0x7e, /* a-f */
+};
+
 enum PARTS {
 	TOKEN_INITIAL_DIGIT,
 	TOKEN_DIGIT,
 	TOKEN_LETTER,
 	TOKEN_SUFFIX,
 	TOKEN_SUFFIX_NO,
+	TOKEN_COMMIT_HASH,
 	TOKEN_REVISION_NO,
 	TOKEN_END,
 	TOKEN_INVALID,
@@ -189,6 +196,13 @@ static void token_next(struct token_state *t, apk_blob_t *b)
 		if (t->suffix == SUFFIX_INVALID) goto invalid;
 		t->token = TOKEN_SUFFIX;
 		break;
+	case '~':
+		if (t->token >= TOKEN_COMMIT_HASH) goto invalid;
+		b->ptr++, b->len--;
+		apk_blob_spn(*b, spn_commit_hash, &t->value, b);
+		if (t->value.len == 0) goto invalid;
+		t->token = TOKEN_COMMIT_HASH;
+		break;
 	case '-':
 		if (t->token >= TOKEN_REVISION_NO) goto invalid;
 		if (!apk_blob_pull_blob_match(b, APK_BLOB_STRLIT("-r"))) goto invalid;
diff --git a/test/version.data b/test/version.data
index c692c455da0018b9b8eb7db9360757ca008e16e8..70a3b276524ad9ec21224a8de64ab1f919586e07 100644
--- a/test/version.data
+++ b/test/version.data
@@ -734,6 +734,9 @@
 8.2.0 < 8.2.001
 8.2.0015 < 8.2.002
 
+1.0~1234 < 1.0~2345
+1.0~1234-r1 > 1.0~1234-r0
+
 3.6.0 ~ 3.6
 3.6.9 ~ 3.6
 3.6_pre1 ~ 3.6
@@ -753,6 +756,7 @@
 
 1.2
 0.1_pre2
+0.1_pre2~1234abcd
 0.1_p1_pre2
 0.1_alpha1_pre2
 0.1_git20240101_pre1
@@ -761,6 +765,10 @@
 !0.1bc1
 !0.1a1
 !0.1a.1
+!0.1_pre2~
+!0.1_pre2~1234xbcd
+!0.1_pre2~1234abcd_pre1
+!0.1_pre2-r1~1234xbcd
 !0.1_foobar
 !0.1_foobar1
 !0.1-pre1.1
